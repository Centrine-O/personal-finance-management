# Supervisor configuration file
# Supervisor is a process manager that keeps our services running
# If a process crashes, supervisor automatically restarts it

[supervisord]
# Run supervisor in the foreground (required for Docker)
nodaemon=true
# Don't require user authentication
user=root

# Apache web server process
# This serves our Laravel application
[program:apache2]
# Command to start Apache in the foreground
command=/usr/sbin/apache2ctl -DFOREGROUND
# Start this program when supervisor starts
autostart=true
# Restart if it crashes
autorestart=true
# Log output to files (useful for debugging)
stdout_logfile=/var/log/apache2/access.log
stderr_logfile=/var/log/apache2/error.log

# Laravel Queue Worker
# This processes background jobs (sending emails, processing uploads, etc.)
[program:laravel-queue]
# Command to start Laravel's queue worker
command=php artisan queue:work --sleep=3 --tries=3 --max-time=3600
# Run in our application directory
directory=/var/www/html
# Start this program when supervisor starts
autostart=true
# Restart if it crashes (important for queue processing)
autorestart=true
# Run as www-data user (same as Apache)
user=www-data
# Redirect output to supervisor logs
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/queue-worker.log
# Stop gracefully (finish current job before stopping)
stopwaitsecs=10

# Laravel Schedule Runner
# This runs scheduled tasks (like monthly budget calculations, bill reminders)
[program:laravel-scheduler]
# Command to run Laravel's scheduler every minute
command=sh -c "while [ true ]; do php artisan schedule:run; sleep 60; done"
# Run in our application directory
directory=/var/www/html
# Start this program when supervisor starts
autostart=true
# Restart if it crashes
autorestart=true
# Run as www-data user
user=www-data
# Redirect output to supervisor logs
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/scheduler.log